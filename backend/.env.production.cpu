# =============================================================================
# PRODUCTION ENVIRONMENT - CPU ONLY (Daily Cron Jobs)
# =============================================================================
# Copy this to .env on production server
# Optimized for 2h/day new content processing


# Database Configuration (UPDATE WITH PRODUCTION CREDENTIALS)
DATABASE_URL=postgresql://postgres:password@localhost:5432/askdrchaffee
POSTGRES_USER=postgres
POSTGRES_PASSWORD=password
POSTGRES_DB=askdrchaffee


# YouTube Configuration
YOUTUBE_CHANNEL_URL=https://www.youtube.com/@anthonychaffeemd
YOUTUBE_API_KEY=


# =============================================================================
# CPU-OPTIMIZED WHISPER CONFIGURATION
# =============================================================================
# Use smaller model for CPU to keep processing time reasonable
WHISPER_MODEL=base  # Smaller model for CPU (was: distil-large-v3)
WHISPER_COMPUTE=int8  # CPU quantization (was: int8_float16)
WHISPER_VAD=false
BEAM_SIZE=3  # Reduced for CPU (was: 5)
TEMPERATURE=0.0
MAX_AUDIO_DURATION=3600

WHISPER_PARALLEL_MODELS=1
WHISPER_DEVICE=cpu  # CPU only in production


# =============================================================================
# CPU-OPTIMIZED CONCURRENCY
# =============================================================================
# Reduced workers for CPU environment
IO_WORKERS=4         # Reduced from 12 (CPU has fewer cores)
ASR_WORKERS=1        # Single worker for CPU (was: 2)
DB_WORKERS=4         # Reduced from 12
BATCH_SIZE=32        # Smaller batches for CPU (was: 256)


# Segment Optimization
SEGMENT_MIN_CHARS=1100
SEGMENT_MAX_CHARS=1400
SEGMENT_MAX_GAP_SECONDS=5.0
SEGMENT_MAX_MERGE_DURATION=120.0


# =============================================================================
# SPEAKER IDENTIFICATION (CPU-OPTIMIZED)
# =============================================================================
ENABLE_SPEAKER_ID=true
VOICES_DIR=voices
CHAFFEE_MIN_SIM=0.62
GUEST_MIN_SIM=0.82
ATTR_MARGIN=0.05
ASSUME_MONOLOGUE=true  # Enable fast-path (critical for CPU performance)
USE_SIMPLE_DIARIZATION=false
AUTO_BOOTSTRAP_CHAFFEE=true
PYANNOTE_CLUSTERING_THRESHOLD=0.3


# =============================================================================
# CPU PERFORMANCE OPTIMIZATION
# =============================================================================
CHUNK_DURATION_SECONDS=30  # Smaller chunks for CPU (was: 45)
ENABLE_FAST_PATH=true  # CRITICAL: Skip diarization when possible
CHAFFEE_ONLY_STORAGE=false
EMBED_CHAFFEE_ONLY=false
VOICE_EMBEDDING_CACHE_MAX_AGE_DAYS=30  # Reuse embeddings from local processing


# Segment Optimization for RAG
ENABLE_SEGMENT_OPTIMIZATION=true
SEGMENT_MIN_CHARS=1100
SEGMENT_MAX_CHARS=1400
SEGMENT_HARD_CAP_CHARS=1800
SEGMENT_OVERLAP_CHARS=250
SEGMENT_MAX_GAP_SECONDS=0.75
SEGMENT_MAX_MERGE_DURATION=90.0


# =============================================================================
# EMBEDDING CONFIGURATION (SAME AS LOCAL FOR QUALITY CONSISTENCY)
# =============================================================================
# CRITICAL: Use SAME model as local to avoid dimension mismatch
# Local has 1536-dim embeddings, production must match!
EMBEDDING_PROFILE=quality  # Same as local

# Use GTE-Qwen2-1.5B on CPU (slower but same quality as local)
EMBEDDING_PROVIDER=local
EMBEDDING_MODEL=Alibaba-NLP/gte-Qwen2-1.5B-instruct  # SAME as local
EMBEDDING_DIMENSIONS=1536  # SAME as local (not 384!)
EMBEDDING_DEVICE=cpu  # CPU only in production
EMBEDDING_BATCH_SIZE=16  # Smaller batches for CPU (was: 256)

# Performance: ~10-15 texts/sec on CPU (vs 170 on GPU)
# For 200 segments: ~17 seconds (acceptable)
# Quality: IDENTICAL to local (no degradation)


# =============================================================================
# RERANKER (NOT NEEDED - Same model as local)
# =============================================================================
# Reranker only needed if using different/smaller model
ENABLE_RERANKER=false  # Disabled (same model as local)
RERANK_TOP_K=200
RETURN_TOP_K=20
RERANK_BATCH_SIZE=16


# =============================================================================
# VOICE ENROLLMENT (CPU-OPTIMIZED)
# =============================================================================
VOICE_ENROLLMENT_BATCH_SIZE=4  # Smaller batches for CPU (was: 16)
SKIP_VOICE_EMBEDDINGS=false


# yt-dlp Configuration
YTDLP_BIN=yt-dlp
YTDLP_OPTS=--sleep-requests 1 --max-sleep-interval 3 --retries 10 --fragment-retries 10 --socket-timeout 20


# Processing Settings
SKIP_SHORTS=true
NEWEST_FIRST=true
RERANK_ENABLED=true
CLEANUP_AUDIO_AFTER_PROCESSING=true


# Audio Storage
STORE_AUDIO_LOCALLY=false


# HuggingFace Configuration
HUGGINGFACE_HUB_TOKEN=your_huggingface_token_here


# OpenAI Configuration
OPENAI_API_KEY=your_openai_api_key_here
SUMMARIZER_MODEL=gpt-4o


APP_PASSWORD=test123
