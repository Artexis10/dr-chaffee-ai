# ============================================================================
# DR. CHAFFEE AI - PRODUCTION ENVIRONMENT CONFIGURATION
# ============================================================================
# Copy this to .env and customize for your environment
# NEVER commit .env to git (already in .gitignore)

# ============================================================================
# DATABASE CONFIGURATION
# ============================================================================
DATABASE_URL=postgresql://user:password@localhost:5432/drchaffee_prod
# For production, use connection pooling:
# DATABASE_URL=postgresql://user:password@host:5432/drchaffee_prod?pool_size=20&max_overflow=10

# ============================================================================
# GPU & PERFORMANCE SETTINGS (RTX 5080 Optimized)
# ============================================================================

# CRITICAL: Enable GPU for embeddings (15x speedup!)
EMBEDDING_DEVICE=cuda

# Embedding model (1.5B params, high quality)
EMBEDDING_MODEL=Alibaba-NLP/gte-Qwen2-1.5B-instruct

# Batch sizes (tuned for RTX 5080 16GB VRAM)
EMBEDDING_BATCH_SIZE=128
VOICE_ENROLLMENT_BATCH_SIZE=4

# Voice embedding cache (prevents re-extraction)
VOICE_EMBEDDING_CACHE_MAX_AGE_DAYS=30

# ============================================================================
# WHISPER ASR CONFIGURATION
# ============================================================================

# Whisper model (distil-large-v3 for speed)
WHISPER_MODEL=distil-large-v3
WHISPER_DEVICE=cuda
WHISPER_COMPUTE_TYPE=int8_float16

# Whisper parameters
WHISPER_BEAM_SIZE=6
WHISPER_CHUNK_LENGTH=45
WHISPER_VAD_FILTER=false

# ============================================================================
# PIPELINE CONCURRENCY (3-phase pipeline)
# ============================================================================

# Phase 1: I/O workers (download, prefilter)
MAX_IO_WORKERS=12

# Phase 2: ASR workers (transcription, diarization)
MAX_ASR_WORKERS=2

# Phase 3: DB workers (embedding, storage)
MAX_DB_WORKERS=12

# ============================================================================
# SPEAKER ATTRIBUTION
# ============================================================================

# Enable fast-path for monologue content (3x speedup)
ENABLE_FAST_PATH=true
ASSUME_MONOLOGUE=true

# Speaker similarity thresholds
CHAFFEE_MIN_SIM=0.620
GUEST_MIN_SIM=0.820
ATTRIBUTION_MARGIN=0.050

# ============================================================================
# OPENAI API (for answer generation)
# ============================================================================

OPENAI_API_KEY=your_openai_api_key_here
SUMMARIZER_MODEL=gpt-4o

# Answer generation settings
ANSWER_ENABLED=true
ANSWER_TOPK=50
ANSWER_TTL_HOURS=336
ANSWER_STYLE_DEFAULT=concise

# ============================================================================
# RAG SERVICE
# ============================================================================

RAG_SERVICE_URL=http://localhost:8000

# ============================================================================
# YOUTUBE DOWNLOAD
# ============================================================================

# yt-dlp settings
YOUTUBE_DOWNLOAD_TIMEOUT=300
YOUTUBE_MAX_RETRIES=3

# ============================================================================
# MONITORING & LOGGING
# ============================================================================

# Log level (DEBUG, INFO, WARNING, ERROR)
LOG_LEVEL=INFO

# GPU telemetry
ENABLE_GPU_TELEMETRY=true
GPU_TELEMETRY_INTERVAL=10

# Performance targets
TARGET_RTF_MIN=0.15
TARGET_RTF_MAX=0.22
TARGET_THROUGHPUT=50

# ============================================================================
# PRODUCTION SAFETY
# ============================================================================

# Prevent accidental data loss
SKIP_EXISTING_VIDEOS=true

# Content hash deduplication
ENABLE_CONTENT_HASH=true

# Error handling
MAX_CONSECUTIVE_ERRORS=5
ERROR_RETRY_DELAY=60

# ============================================================================
# OPTIONAL: ADVANCED TUNING
# ============================================================================

# Skip voice embeddings entirely (fastest, least accurate)
# SKIP_VOICE_EMBEDDINGS=false

# Disable diarization (force fast-path)
# DISABLE_DIARIZATION=false

# Two-pass QA (improves accuracy, slower)
TWO_PASS_QA=true

# Word alignment (legacy, not needed)
ALIGN_WORDS=false
