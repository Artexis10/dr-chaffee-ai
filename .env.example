# =============================================================================
# RTX 5080 OPTIMIZED DR. CHAFFEE INGESTION PIPELINE CONFIGURATION
# =============================================================================

# Database Configuration
DATABASE_URL=postgresql://postgres:password@localhost:5432/askdrchaffee
POSTGRES_USER=postgres
POSTGRES_PASSWORD=password
POSTGRES_DB=askdrchaffee

# YouTube Configuration
YOUTUBE_CHANNEL_URL=https://www.youtube.com/@anthonychaffeemd
YOUTUBE_API_KEY=

# RTX 5080 Whisper Configuration (Production Optimized)
WHISPER_MODEL=distil-large-v3
WHISPER_COMPUTE=int8_float16
WHISPER_VAD=false
BEAM_SIZE=5
TEMPERATURE=0.0
MAX_AUDIO_DURATION=3600

# Parallel Whisper Models
# GPU (CUDA): Set to 1 (GPU parallelizes internally, multi-model is slower)
# CPU: Set to 2-4 (bypasses Python GIL for true multi-threading)
WHISPER_PARALLEL_MODELS=1  # Default: 1 for GPU, 2-4 for CPU production
WHISPER_DEVICE=cuda  # 'cuda' for GPU, 'cpu' for production

# RTX 5080 Concurrency Settings (Balanced for 75-85% GPU)
IO_WORKERS=24        # Fixed download bottleneck
ASR_WORKERS=4        # Increased: I/O fixed, can feed 4 workers now
DB_WORKERS=12
BATCH_SIZE=1024      # Tripled: Use available VRAM (9.6GB unused)

# Segment Optimization (for better semantic search)
SEGMENT_MIN_CHARS=1100    # Minimum chars for optimal segments
SEGMENT_MAX_CHARS=1400    # Maximum chars before splitting
SEGMENT_MAX_GAP_SECONDS=5.0      # Merge across pauses up to 5 seconds
SEGMENT_MAX_MERGE_DURATION=120.0  # Allow segments up to 2 minutes long

# Speaker Identification
ENABLE_SPEAKER_ID=true
VOICES_DIR=voices
CHAFFEE_MIN_SIM=0.62
GUEST_MIN_SIM=0.82
ATTR_MARGIN=0.05
ASSUME_MONOLOGUE=true
USE_SIMPLE_DIARIZATION=false
AUTO_BOOTSTRAP_CHAFFEE=true

# Performance Optimization
CHUNK_DURATION_SECONDS=45
ENABLE_FAST_PATH=true
CHAFFEE_ONLY_STORAGE=false

# Segment Optimization for RAG (GPT-5 recommended settings)
ENABLE_SEGMENT_OPTIMIZATION=true
SEGMENT_MIN_CHARS=1100          # Target minimum for good context
SEGMENT_MAX_CHARS=1400          # Target maximum (hard cap: 1800)
SEGMENT_HARD_CAP_CHARS=1800     # Absolute maximum
SEGMENT_OVERLAP_CHARS=250       # Overlap between segments (220-300)
SEGMENT_MAX_GAP_SECONDS=0.75    # Merge across pauses â‰¥750ms
SEGMENT_MAX_MERGE_DURATION=90.0 # 60-90 seconds per segment

# Embedding Configuration (GTE-Qwen2-1.5B for best quality)
EMBEDDING_PROVIDER=local
EMBEDDING_MODEL=Alibaba-NLP/gte-Qwen2-1.5B-instruct
EMBEDDING_DIMENSIONS=1536

# yt-dlp Configuration
YTDLP_BIN=yt-dlp
YTDLP_OPTS=--sleep-requests 1 --max-sleep-interval 3 --retries 10 --fragment-retries 10 --socket-timeout 20
YTDLP_DOWNLOAD_SEMAPHORE=20  # Max concurrent downloads (10-30 recommended)

# Processing Settings
SKIP_SHORTS=true
NEWEST_FIRST=true
RERANK_ENABLED=true
CLEANUP_AUDIO_AFTER_PROCESSING=true

# HuggingFace Configuration (for model downloads)
HUGGINGFACE_HUB_TOKEN=your_huggingface_token_here

# OpenAI Configuration (Optional - for embeddings or summarization)
OPENAI_API_KEY=your_openai_api_key_here
SUMMARIZER_MODEL=gpt-3.5-turbo

# Answer Mode Configuration
ANSWER_ENABLED=true
ANSWER_TOPK=40
ANSWER_TTL_HOURS=336
SUMMARIZER_MODEL=gpt-3.5-turbo
ANSWER_STYLE_DEFAULT=concise

# Audio Storage Cleanup
# Set to 'true' to automatically delete audio files after processing embeddings
CLEANUP_AUDIO_AFTER_PROCESSING=false
